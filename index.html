<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© â€” SPA Ù‡Ø±Ù…ÙŠØ© + ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ</title>
  <style>
    :root {
      --primary-bg: #0f1419;
      --secondary-bg: #141a22;
      --card-bg: #1b2230;
      --border: #273040;
      --ink: #e7eef7;
      --muted: #9aa7b4;
      --accent: #22c55e;
      --accent-2: #4098e6;
      --hover: #243042;
      --header-h: 100px;
      --gap: 10px;
      --sidebar-w: 200px;          /* Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ */
      --sidebar-collapsed-w: 64px; /* Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ØµØºÙ‘Ø± Ø¨Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ÙÙ‚Ø· */
      --mask-w: 15px;              /* Ø¹Ø±Ø¶ Ù‚Ù†Ø§Ø¹ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³Ù‘ÙƒØ±ÙˆÙˆÙ„ */
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: var(--primary-bg); color: var(--ink); font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial; overflow: hidden; }

    /* ===== Header ===== */
    .header { display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, var(--secondary-bg), var(--card-bg)); border-bottom: 1px solid var(--border); padding: 10px 16px; box-shadow: 0 6px 18px #0006; position: sticky; top: 0; z-index: 30; }
    .toggle { appearance: none; background: var(--secondary-bg); color: var(--ink); border: 1px solid var(--border); border-radius: 10px; padding: 7px 12px; cursor: pointer; font-weight: 700; transition: background .2s ease; }
    .toggle:hover { background: var(--hover); }
    .header-title { text-align: center; flex: 1; }
    .header-title h1 { margin: 0; color: var(--accent); font-size: 22px; }
    .header-title p { margin: 0; color: var(--muted); font-size: 13px; }
    .mini-status { color: var(--muted); font-size: 12px; text-align: right; white-space: nowrap; }

    /* ===== Layout ===== */
    .wrap { width: 100%; padding: var(--gap); position: relative; }
    .main { display: grid; grid-template-columns: var(--sidebar-w) 1fr; gap: var(--gap); height: calc(100vh - var(--header-h)); transition: grid-template-columns .25s ease; }
    body.sidebar-collapsed .main { grid-template-columns: var(--sidebar-collapsed-w) 1fr; }

    /* ===== Sidebar ===== */
    .sidebar { background: var(--secondary-bg); border: 1px solid var(--border); border-radius: 12px; padding: 8px; display: flex; flex-direction: column; min-height: 0; overflow: hidden; }
    .sidebar .title-sb { display: flex; align-items: center; gap: 8px; color: var(--muted); font-weight: 700; margin: 4px 6px 8px; }
    .tabs { display: flex; flex-direction: column; gap: 6px; overflow: hidden; }

    .tab { display:flex; align-items:center; gap:10px; appearance: none; border: 1px solid var(--border); background: transparent; color: var(--ink); padding: 9px 10px; border-radius: 10px; cursor: pointer; font-weight: 600; text-align: left; transition: .18s; font-size: 13px; width:100%; }
    .tab:hover { background: var(--hover); }
    .tab.active { background: var(--accent-2); border-color: #2b6cb0; color: #071018; }
    .ico { width:24px; text-align:center; font-size:18px; opacity:.9 }
    .lbl { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    body.sidebar-collapsed .sidebar .title-sb span.txt { display:none; }
    body.sidebar-collapsed .tab { padding:10px 6px; justify-content:center; }
    body.sidebar-collapsed .tab .lbl { display:none; }

    /* Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø£Ø¨ + Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ© */
    .group { display:block; }
    .tab.parent { justify-content:space-between; }
    .tab.parent .chev { margin-inline-start:auto; opacity:.8; transition:.2s; }
    .submenu { display:none; padding-inline-start: 8px; margin-top:6px; }
    .submenu.open { display:block; animation: drop .18s ease; }
    @keyframes drop{ from{ opacity:0; transform:translateY(-4px) } to{ opacity:1; transform:none } }
    body.sidebar-collapsed .submenu { display:none !important; }

    /* ===== Content ===== */
    .contentWrap { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; min-width: 0; min-height: 0; display: flex; }
    .frame { flex: 1; padding: var(--gap); }
    .frame-inner { position:relative; border: none; border-radius: 12px; height: 100%; overflow: hidden; background: #0b1220; }

    iframe { display: block; width: 100%; height: calc(100vh - var(--header-h) - (var(--gap) * 2)); border: none; border-radius: 12px; overflow: auto; }
    iframe::-webkit-scrollbar { width: 0 !important; height: 0 !important; }

    .mask { position:absolute; top:0; bottom:0; width:var(--mask-w); background: var(--card-bg); pointer-events:none; z-index:5; }
    .mask.left  { left:0; border-top-left-radius:12px; border-bottom-left-radius:12px; }
    .mask.right { right:0; border-top-right-radius:12px; border-bottom-right-radius:12px; }
  </style>
</head>
<body class="sidebar-collapsed">
  <div class="header" id="header">
    <button class="toggle" id="toggleBtn" title="Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©">â˜°</button>
    <div class="header-title">
      <h1>ğŸ  Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h1>
      <p>Ø´Ø±ÙŠØ· ÙŠØ³Ø§Ø± Ù‡Ø±Ù…ÙŠ + ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ø¨Ø¯ÙˆÙ† Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„</p>
    </div>
    <div class="mini-status">Ø§Ù„Ø­Ø§Ù„Ø©: <span id="status">Ø¬Ø§Ù‡Ø²</span> â€¢ Ø§Ù„Ù…Ø³Ø§Ø±: <span id="path">#/page2</span></div>
  </div>

  <div class="wrap">
    <div class="main">
      <aside class="sidebar" id="sidebar">
        <div class="title-sb"><span class="ico">ğŸ“‚</span><span class="txt">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</span></div>
        <div class="tabs" id="tabs"><!-- ÙŠÙØ¨Ù†Ù‰ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ --></div>
      </aside>

      <main class="contentWrap">
        <div class="frame">
          <div class="frame-inner">
            <div class="mask left"></div>
            <div class="mask right"></div>
            <iframe id="viewer" title="Viewer"></iframe>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    /* =====================
       Ù…ØµØ§Ø¯Ø± Ø£Ø³Ø§Ø³ÙŠØ© Ø«Ø§Ø¨ØªØ©
    ===================== */
    const BASE_ROOT_ITEMS = [
      { id:'home',     type:'page', inline:true,            label:'Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠØ©', icon:'ğŸ ' },
      { id:'page1',    type:'page', file:'page1.html',      label:'Ù…Ø¯ÙŠØ± Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ SQL', icon:'ğŸ§®' },
      { id:'page2',    type:'page', file:'page2.html',      label:'(Ù…ØµØ·ÙÙ‰) Ø´Ø±Ø§ÙƒØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©',   icon:'ğŸ“Š' },
      { id:'page3', type:'page', file:'page3.html',   label:'Ø®Ø·Ø© Ø¹Ø¯Ù… Ø§Ù„ØªØ¹Ø«Ø±',        icon:'ğŸ“Š' },
      { id:'settings', type:'page', file:'settings.html',   label:'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',        icon:'âš™ï¸' }
    ];

    /* ØªØ­Ù…ÙŠÙ„/Ø­ÙØ¸ Ø§Ù„Ø´Ø¬Ø±Ø© Ø§Ù„Ù‡Ø±Ù…ÙŠØ© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ù† settings.html */
    const TREE_KEY = 'customMenuTree';
  function getCustomTree(){ try{ return JSON.parse(localStorage.getItem(TREE_KEY)||'[]'); }catch{ return []; } }
  function setCustomTree(tree){ localStorage.setItem(TREE_KEY, JSON.stringify(tree||[])); }

  /* Ø¯Ø¹Ù… Ø§Ù„Ø¥ØµØ¯Ø§Ø±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© (settings Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©): customPages => ØªØ­ÙˆÙŠÙ„Ù‡Ø§ Ù„Ø¹ÙÙ‚ÙØ¯ ØµÙØ­Ø§Øª */
  const LEGACY_KEY = 'customPages';
  function getLegacyPages(){
    try{
      const arr = JSON.parse(localStorage.getItem(LEGACY_KEY) || '[]');
      return Array.isArray(arr) ? arr.map(p => ({
        id:p.id, label:p.label||p.id, icon:p.icon||'â€¢',
        type:'page', file:p.file, children:[]
      })) : [];
    }catch{ return []; }
  }

  /* Ø´Ø¬Ø±Ø© Ù…ÙˆØ­Ù‘Ø¯Ø© ØªØ¬Ù…Ø¹ Ø§Ù„Ù‡ÙŠØ±Ø§Ø±ÙƒÙŠ + Ø§Ù„Ù‚Ø¯ÙŠÙ… */
  function getMergedTree(){
    const tree = getCustomTree();
    const legacy = getLegacyPages();
    // Ù„Ùˆ ÙÙŠ Ø¹Ù†Ø§ØµØ± Ù‚Ø¯ÙŠÙ…Ø© ÙˆÙ„Ø³Ù‡ Ù…ÙÙŠØ´ Ø´Ø¬Ø±Ø© Ù‡ÙŠØ±Ø§Ø±ÙƒÙŠØ© â€” Ù‡Ø§ØªÙ‡Ø§ Ù…Ø¤Ù‚ØªÙ‹Ø§
    return tree.length ? tree : legacy;
  }

  /* Ù‡Ø¬Ø±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©: Ù„Ùˆ ÙÙŠÙ‡ customPages ÙˆÙ…ÙÙŠØ´ customMenuTreeØŒ Ø§Ù†Ù‚Ù„Ù‡Ù… Ù„Ù„Ø´Ø¬Ø±Ø© ÙˆØ§Ø­Ø°Ù Ø§Ù„Ù‚Ø¯ÙŠÙ… */
  (function migrateLegacy(){
    const tree = getCustomTree();
    const legacy = getLegacyPages();
    if(!tree.length && legacy.length){
      setCustomTree(legacy);
      try{ localStorage.removeItem(LEGACY_KEY); }catch{}
    }
  })();
    function getCustomTree(){ try{ return JSON.parse(localStorage.getItem(TREE_KEY)||'[]'); }catch{ return []; } }
    function setCustomTree(tree){ localStorage.setItem(TREE_KEY, JSON.stringify(tree||[])); }

    /* ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ (ÙŠØ¯Ø¹Ù… Parent + Submenu) */
    const tabs = document.getElementById('tabs');

    function pageBtn(n){
      return `<button class="tab" data-route="#/${n.id}"><span class="ico">${n.icon||'â€¢'}</span><span class="lbl">${n.label||n.id}</span></button>`;
    }
    function parentGroup(n){
      const kids = (n.children||[]).map(c=> pageBtn(c)).join('');
      return `<div class="group">
        <button class="tab parent" type="button" data-group="${n.id}">
          <span class="ico">${n.icon||'â€¢'}</span>
          <span class="lbl">${n.label||n.id}</span>
          <span class="chev">â–¾</span>
        </button>
        <div class="submenu" data-of="${n.id}">${kids || '<div class="muted" style="padding:8px 10px">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµÙØ­Ø§Øª Ø¨Ø¹Ø¯</div>'}</div>
      </div>`;
    }

    function buildSidebar(){
      // const roots = [...BASE_ROOT_ITEMS, ...getCustomTree()];
      const roots = [...BASE_ROOT_ITEMS, ...getMergedTree()];
      tabs.innerHTML = roots.map(n=> n.type==='parent' ? parentGroup(n) : pageBtn(n)).join('');
      
      // Ø³Ù„ÙˆÙƒ ÙØªØ­/ØºÙ„Ù‚ Ø§Ù„ÙØ±Ø¹ÙŠ
      tabs.querySelectorAll('.tab.parent').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const box = tabs.querySelector(`.submenu[data-of="${btn.dataset.group}"]`);
          box && box.classList.toggle('open');
        });
      });
    }

    /* Ø§Ù„Ø±Ø§ÙˆØªØ±: ØªØ¬Ù…ÙŠØ¹ ÙƒÙ„ Ø§Ù„ØµÙØ­Ø§Øª (ÙÙ‚Ø· Ø§Ù„Ù†ÙˆØ¹ Page) */
    const viewer   = document.getElementById('viewer');
    const statusEl = document.getElementById('status');
    const pathEl   = document.getElementById('path');
    const toggleBtn= document.getElementById('toggleBtn');

    function toggleSidebar(){ document.body.classList.toggle('sidebar-collapsed'); }
    toggleBtn.addEventListener('click', toggleSidebar);

    // function getAllPages(){
    //   const flat = [];
    //   const walk = (n)=>{ if(n.type==='page') flat.push(n); (n.children||[]).forEach(walk); };
    //   [...BASE_ROOT_ITEMS, ...getCustomTree()].forEach(walk);
    //   return flat;
    // }

      function getAllPages() {
        const flat = [];
        const walk = (n) => { if (n.type === 'page') flat.push(n); (n.children || []).forEach(walk); };
        [...BASE_ROOT_ITEMS, ...getMergedTree()].forEach(walk);
        return flat;
      }


    function getRoutes(){
      return Object.fromEntries(getAllPages().map(n => [ `#/${n.id}`, n.inline ? {type:'inline'} : { file:n.file } ]));
    }

    function setActiveTab(hash){
      document.querySelectorAll('.tab').forEach(btn => btn.classList.toggle('active', btn.dataset.route === hash));
    }

    function injectHideScrollbarCSS(){
      try{
        const doc = viewer.contentDocument || viewer.contentWindow.document;
        if(!doc) return;
        const style = doc.createElement('style');
        style.textContent = `html,body{overflow:auto!important;scrollbar-width:none!important;-ms-overflow-style:none!important} ::-webkit-scrollbar{display:none!important;width:0;height:0}`;
        doc.head && doc.head.appendChild(style);
      }catch(e){ }
    }

    function inlineWelcome(){
      const html = `<!DOCTYPE html><html lang="ar" dir="ltr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ØªØ¹Ø±ÙŠÙ</title>
        <style>html,body{margin:0;overflow:auto;scrollbar-width:none;-ms-overflow-style:none} ::-webkit-scrollbar{display:none;width:0;height:0} body{background:#0b1220;color:#e2e8f0;font:14px system-ui} .box{padding:24px} h2{margin:0 0 10px;color:#22c55e} p{color:#a0aec0}</style></head>
        <body><div class="box"><h2>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ğŸ‘‹</h2><p>Ù‡Ø°Ù‡ ØµÙØ­Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©.
        ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Parents Ùˆ Pages Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù„ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ ÙÙˆØ±Ù‹Ø§.</p></div></body></html>`;
      const blob = new Blob([html], { type: 'text/html' });
      viewer.src = URL.createObjectURL(blob);
    }

    function navigate(hash){
      const ROUTES = getRoutes();
      const route = ROUTES[hash] || ROUTES['#/page2'] || ROUTES['#/home'];
      pathEl && (pathEl.textContent = hash);
      setActiveTab(hash);
      statusEl && (statusEl.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦');

      if(route?.type === 'inline'){
        viewer.onload = () => { statusEl && (statusEl.textContent = 'Ø¬Ø§Ù‡Ø²'); injectHideScrollbarCSS(); };
        inlineWelcome();
        return;
      }
      viewer.onload = () => { statusEl && (statusEl.textContent = 'Ø¬Ø§Ù‡Ø²'); injectHideScrollbarCSS(); };
      viewer.onerror = () => { statusEl && (statusEl.textContent = 'ØªØ¹Ø°Ù‘Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„'); };
      viewer.src = route?.file || '';
    }

    // Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ (ØªØ¬Ø§Ù‡Ù„ parent)
    tabs.addEventListener('click', e => {
      const btn = e.target.closest('.tab');
      if(!btn || btn.classList.contains('parent')) return;
      const hash = btn.dataset.route;
      if(hash) location.hash = hash;
    });

    // // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ØªØ­Ø¯ÙŠØ«Ø§Øª ÙÙˆØ±ÙŠØ© Ù…Ù† settings.html
    // window.addEventListener('message', (e)=>{
    //   if(!e.data) return;
    //   if(e.data.type==='MENU_TREE_UPDATED'){
    //     setCustomTree(e.data.tree||[]);
    //     buildSidebar();
    //     setActiveTab(location.hash);
    //   }
    // });

    window.addEventListener('message', (e)=>{
  if(!e.data) return;

  // Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ù‡ÙŠØ±Ø§Ø±ÙƒÙŠØ©
  if(e.data.type === 'MENU_TREE_UPDATED'){
    setCustomTree(e.data.tree || []);
    buildSidebar();
    setActiveTab(location.hash);
    return;
  }

  // Ø¯Ø¹Ù… Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©: NEW_PAGE_ADDED / PAGE_REMOVED
  if(e.data.type === 'NEW_PAGE_ADDED' && e.data.page){
    // Ø£Ø¶Ù Ù„Ù„Ù‘ÙŠØ¬Ø§Ø³ÙŠ Ø«Ù… Ù‡Ø§Ø¬Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ø§Ù„Ù‡Ø¬Ø±Ø© Ù‡ØªØ´ØºÙ„ buildSidebar Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø·Ø±ÙŠÙ† Ø¯ÙˆÙ„)
    const saved = JSON.parse(localStorage.getItem(LEGACY_KEY) || '[]');
    saved.push(e.data.page);
    localStorage.setItem(LEGACY_KEY, JSON.stringify(saved));
    // Ø´ØºÙ‘Ù„ Ø§Ù„Ù…Ù‡Ø§Ø¬Ø± ÙˆØ§Ø¨Ù‚ÙÙ Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø³Ù„Ø³Ø©
    (function migrateAgain(){
      const legacy = getLegacyPages();
      if(legacy.length){
        setCustomTree(legacy);
        try{ localStorage.removeItem(LEGACY_KEY); }catch{}
      }
    })();
    buildSidebar();
    setActiveTab(location.hash);
    return;
  }

  if(e.data.type === 'PAGE_REMOVED' && e.data.id){
    // Ù„Ùˆ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø´ØºÙ‘Ø§Ù„Ø©
    const saved = JSON.parse(localStorage.getItem(LEGACY_KEY) || '[]')
      .filter(p => p.id !== e.data.id);
    localStorage.setItem(LEGACY_KEY, JSON.stringify(saved));
    // Ø£Ø¹ÙØ¯ Ø§Ù„Ù‡Ø¬Ø±Ø©
    (function migrateAgain(){
      const legacy = getLegacyPages();
      setCustomTree(legacy);
      try{ localStorage.removeItem(LEGACY_KEY); }catch{}
    })();
    buildSidebar();
    setActiveTab(location.hash);
    return;
  }
});





    
    // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
    buildSidebar();
    window.addEventListener('hashchange', () => navigate(location.hash));
    if(!location.hash) location.hash = '#/page2';
    navigate(location.hash);
  </script>
</body>
</html>
