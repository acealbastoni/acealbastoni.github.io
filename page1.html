<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Code Manager - Ù…Ø¯ÙŠØ± Ø£ÙƒÙˆØ§Ø¯ SQL</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-bg: #0f1419;
            --secondary-bg: #1a1f2e;
            --card-bg: #1e2433;
            --border-color: #2d3748;
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --accent-green: #48bb78;
            --accent-blue: #4299e1;
            --accent-red: #f56565;
            --hover-bg: #2d3748;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--primary-bg);
            color: var(--text-primary);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--card-bg) 100%);
            padding: 30px;
            text-align: center;
            border-bottom: 2px solid var(--border-color);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 32px;
            font-weight: 700;
            color: var(--accent-green);
            margin-bottom: 10px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }

        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        /* Card */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            font-size: 20px;
            font-weight: 600;
            color: var(--accent-blue);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-header::before {
            content: 'ğŸ“';
            font-size: 24px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px 15px;
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }

        .form-textarea {
            min-height: 200px;
            resize: vertical;
            line-height: 1.5;
        }

        /* Code Preview */
        .code-preview {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .code-preview::-webkit-scrollbar {
            width: 8px;
        }

        .code-preview::-webkit-scrollbar-track {
            background: var(--primary-bg);
            border-radius: 4px;
        }

        .code-preview::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        .code-preview::-webkit-scrollbar-thumb:hover {
            background: var(--hover-bg);
        }

        /* Buttons */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--accent-green);
            color: white;
        }

        .btn-primary:hover {
            background: #38a169;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
        }

        .btn-secondary {
            background: var(--accent-blue);
            color: white;
        }

        .btn-secondary:hover {
            background: #3182ce;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.4);
        }

        .btn-danger {
            background: var(--accent-red);
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Code List */
        .code-list {
            display: grid;
            gap: 15px;
        }

        .code-item {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .code-item:hover {
            border-color: var(--accent-blue);
            transform: translateX(-5px);
        }

        .code-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .code-item-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--accent-green);
        }

        .code-item-date {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .code-item-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .code-item-preview {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 10px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            max-height: 100px;
            overflow: hidden;
            position: relative;
        }

        .code-item-preview::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: linear-gradient(transparent, var(--card-bg));
        }

        .code-item-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-small {
            padding: 6px 15px;
            font-size: 13px;
        }

        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--accent-green);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Search Box */
        .search-box {
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 15px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%23a0aec0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cpath d='m21 21-4.35-4.35'%3E%3C/path%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 15px center;
        }

        /* Alert */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: rgba(72, 187, 120, 0.1);
            border: 1px solid var(--accent-green);
            color: var(--accent-green);
        }

        .alert-error {
            background: rgba(245, 101, 101, 0.1);
            border: 1px solid var(--accent-red);
            color: var(--accent-red);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-green);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: var(--hover-bg);
            color: var(--text-primary);
        }

        .modal-code {
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 18px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <!-- <div class="header">
        <h1>ğŸ—„ï¸ SQL Code Manager(V1)</h1>
        <p>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© ÙˆØ­ÙØ¸ Ø£ÙƒÙˆØ§Ø¯ SQL Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</p>
    </div> -->

    <!-- Container -->
    <div class="container">
        <!-- Alert -->
        <div id="alert" class="alert"></div>

        <!-- Stats -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalCodes">0</div>
                <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="todayCodes">0</div>
                <div class="stat-label">Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ÙŠÙˆÙ…</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalSize">0 KB</div>
                <div class="stat-label">Ø­Ø¬Ù… Ø§Ù„Ù…Ù„ÙØ§Øª</div>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="grid">
            <!-- Add Code Form -->
            <div class="card">
                <div class="card-header">Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ SQL Ø¬Ø¯ÙŠØ¯</div>
                
                <form id="codeForm">
                    <div class="form-group">
                        <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒÙˆØ¯</label>
                        <input type="text" class="form-input" id="codeTitle" placeholder="Ù…Ø«Ø§Ù„: Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ÙˆØµÙ Ø§Ù„ÙƒÙˆØ¯</label>
                        <textarea class="form-textarea" id="codeDescription" placeholder="Ø§ÙƒØªØ¨ ÙˆØµÙØ§Ù‹ ØªÙØµÙŠÙ„ÙŠØ§Ù‹ Ù„Ù„ÙƒÙˆØ¯..." rows="3" required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ÙƒÙˆØ¯ SQL</label>
                        <textarea class="form-textarea" id="sqlCode" placeholder="SELECT * FROM users WHERE..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                        <select class="form-select" id="codeCategory">
                            <option value="select">SELECT Queries</option>
                            <option value="insert">INSERT Statements</option>
                            <option value="update">UPDATE Statements</option>
                            <option value="delete">DELETE Statements</option>
                            <option value="create">CREATE Tables</option>
                            <option value="alter">ALTER Tables</option>
                            <option value="procedure">Stored Procedures</option>
                            <option value="function">Functions</option>
                            <option value="trigger">Triggers</option>
                            <option value="other">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>

                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">
                            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ÙƒÙˆØ¯
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">
                            ğŸ”„ Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
                        </button>
                    </div>
                </form>
            </div>

            <!-- Codes List -->
            <div class="card">
                <div class="card-header">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</div>
                
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯...">
                </div>

                <div class="code-list" id="codeList">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <div class="empty-state-text">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="codeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle"></h2>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div>
                <p style="color: var(--text-secondary); margin-bottom: 15px;"><strong>Ø§Ù„ÙˆØµÙ:</strong> <span id="modalDescription"></span></p>
                <p style="color: var(--text-secondary); margin-bottom: 15px;"><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> <span id="modalDate"></span></p>
                <p style="color: var(--text-secondary); margin-bottom: 15px;"><strong>Ø§Ù„ØªØµÙ†ÙŠÙ:</strong> <span id="modalCategory"></span></p>
                <div class="modal-code" id="modalCode"></div>
                <div class="btn-group" style="margin-top: 20px;">
                    <button class="btn btn-secondary btn-small" onclick="copyCode()">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
                    <button class="btn btn-primary btn-small" onclick="downloadCurrentCode()">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Database simulation using LocalStorage
      
        const DB = {
    apiUrl: 'https://script.google.com/macros/s/AKfycbykEDwS_tYFRnJ4Ui8YRzUnTpdrRnxhrR_58y12bq5qHG2aiEiGsUDil4xoT_hqHg70/exec',
    
    async getAll() {
        try {
            const response = await fetch(this.apiUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({ action: 'list' })
            });
            
            // Since no-cors mode doesn't allow reading response,
            // we'll use a different approach - redirect to GET
            const getData = await fetch(`${this.apiUrl}?action=list&_=${Date.now()}`, {
                method: 'GET',
                redirect: 'follow'
            });
            
            return await getData.json();
        } catch (error) {
            console.error('Error getting all codes:', error);
            return [];
        }
    },
    
    async add(code) {
        try {
            // Send data
            await fetch(this.apiUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({ 
                    action: 'save',
                    ...code
                })
            });
            
            // Give it time to save
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            return { success: true, filename: code.id + '.sql' };
        } catch (error) {
            console.error('Error adding code:', error);
            throw error;
        }
    },
    
    async delete(id) {
        try {
            await fetch(this.apiUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify({ 
                    action: 'delete',
                    id: id
                })
            });
            
            await new Promise(resolve => setTimeout(resolve, 500));
            return { success: true };
        } catch (error) {
            console.error('Error deleting code:', error);
            throw error;
        }
    },
    
    async get(id) {
        try {
            const response = await fetch(`${this.apiUrl}?action=get&id=${id}&_=${Date.now()}`, {
                method: 'GET',
                redirect: 'follow'
            });
            return await response.json();
        } catch (error) {
            console.error('Error getting code:', error);
            return null;
        }
    }
};



        let currentCodeId = null;

        // Generate unique ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Format date
        function formatDate(date) {
            return new Date(date).toLocaleString('ar-SA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Show alert
        function showAlert(message, type = 'success') {
            const alert = document.getElementById('alert');
            alert.className = `alert alert-${type} show`;
            alert.textContent = message;
            
            setTimeout(() => {
                alert.classList.remove('show');
            }, 3000);
        }

        // Save code to file
        function saveCodeToFile(code) {
            const filename = `${code.id}_${code.category}_${Date.now()}.sql`;
            const content = `-- Title: ${code.title}\n-- Description: ${code.description}\n-- Category: ${code.category}\n-- Date: ${formatDate(code.date)}\n-- ID: ${code.id}\n\n${code.sqlCode}`;
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
            
            return filename;
        }

        // Form submission


        document.getElementById('codeForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Show loading
    showAlert('â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...', 'success');
    
    const code = {
        id: generateId(),
        title: document.getElementById('codeTitle').value.trim(),
        description: document.getElementById('codeDescription').value.trim(),
        sqlCode: document.getElementById('sqlCode').value.trim(),
        category: document.getElementById('codeCategory').value,
        date: new Date().toISOString()
    };
    
    try {
        const result = await DB.add(code);
        
        if (result.success) {
            await renderCodes();
            await updateStats();
            resetForm();
            showAlert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ Google Sheets!');
        } else {
            showAlert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸!', 'error');
        }
    } catch (error) {
        console.error(error);
        showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…!', 'error');
    }
});





        // Reset form
        function resetForm() {
            document.getElementById('codeForm').reset();
        }

        // Render codes list
        async function renderCodes(filter = '') {
    const codeList = document.getElementById('codeList');
    
    try {
        let codes = await DB.getAll();
        
        if (filter) {
            codes = codes.filter(c => 
                c.title.toLowerCase().includes(filter.toLowerCase()) ||
                c.description.toLowerCase().includes(filter.toLowerCase()) ||
                c.sqlCode.toLowerCase().includes(filter.toLowerCase())
            );
        }
        
        if (codes.length === 0) {
            codeList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“­</div>
                    <div class="empty-state-text">${filter ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬' : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯'}</div>
                </div>
            `;
            return;
        }
        
        codes.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        codeList.innerHTML = codes.map(code => `
            <div class="code-item" onclick="viewCode('${code.id}')">
                <div class="code-item-header">
                    <div class="code-item-title">${code.title}</div>
                    <div class="code-item-date">${formatDate(code.date)}</div>
                </div>
                <div class="code-item-description">${code.description}</div>
                <div class="code-item-preview">${escapeHtml(code.sqlCode)}</div>
                <div class="code-item-actions">
                    <button class="btn btn-secondary btn-small" onclick="event.stopPropagation(); downloadCode('${code.id}')">
                        â¬‡ï¸ ØªØ­Ù…ÙŠÙ„
                    </button>
                    <button class="btn btn-danger btn-small" onclick="event.stopPropagation(); deleteCode('${code.id}')">
                        ğŸ—‘ï¸ Ø­Ø°Ù
                    </button>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error(error);
        codeList.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">âš ï¸</div>
                <div class="empty-state-text">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
            </div>
        `;
    }
}






        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // View code in modal
        async function viewCode(id) {
    try {
        const code = await DB.get(id);
        if (!code) return;
        
        currentCodeId = id;
        document.getElementById('modalTitle').textContent = code.title;
        document.getElementById('modalDescription').textContent = code.description;
        document.getElementById('modalDate').textContent = formatDate(code.date);
        document.getElementById('modalCategory').textContent = code.category;
        document.getElementById('modalCode').textContent = code.sqlCode;
        document.getElementById('codeModal').classList.add('active');
    } catch (error) {
        console.error(error);
        showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯!', 'error');
    }
}

        // Close modal
        function closeModal() {
            document.getElementById('codeModal').classList.remove('active');
            currentCodeId = null;
        }

        // Copy code
        function copyCode() {
            const code = DB.get(currentCodeId);
            if (!code) return;
            
            navigator.clipboard.writeText(code.sqlCode).then(() => {
                showAlert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯!');
            });
        }

        // Download code
        async function downloadCode(id) {
    try {
        const code = await DB.get(id);
        if (!code) return;
        
        const filename = code.filename;
        const content = `-- Title: ${code.title}\n-- Description: ${code.description}\n-- Category: ${code.category}\n-- Date: ${formatDate(code.date)}\n-- ID: ${code.id}\n\n${code.sqlCode}`;
        
        const blob = new Blob([content], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
        
        showAlert('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù!');
    } catch (error) {
        console.error(error);
        showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„!', 'error');
    }
}

        // Download current code from modal
        function downloadCurrentCode() {
            if (currentCodeId) {
                downloadCode(currentCodeId);
            }
        }

        // Delete code
        async function deleteCode(id) {
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ØŸ')) {
        try {
            const result = await DB.delete(id);
            if (result.success) {
                await renderCodes();
                await updateStats();
                showAlert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯!');
            }
        } catch (error) {
            console.error(error);
            showAlert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù!', 'error');
        }
    }
}

        // Update stats
        async function updateStats() {
    try {
        const codes = await DB.getAll();
        const today = new Date().toDateString();
        const todayCodes = codes.filter(c => new Date(c.date).toDateString() === today);
        const totalSize = codes.reduce((sum, c) => sum + c.sqlCode.length, 0);
        
        document.getElementById('totalCodes').textContent = codes.length;
        document.getElementById('todayCodes').textContent = todayCodes.length;
        document.getElementById('totalSize').textContent = (totalSize / 1024).toFixed(2) + ' KB';
    } catch (error) {
        console.error(error);
    }
}
        // Search
        document.getElementById('searchInput').addEventListener('input', function(e) {
            renderCodes(e.target.value);
        });

        // Close modal on outside click
        document.getElementById('codeModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Initialize
     // Initialize on page load
(async function() {
    await renderCodes();
    await updateStats();
})();
    </script>
</body>
</html>