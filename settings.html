<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª â€” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ (Ù‚ÙˆØ§Ø¦Ù… Ø£Ø¨/ÙØ±Ø¹ÙŠØ©)</title>
  <style>
    /* â€”â€”â€” Ù„ÙˆØ­Ø© Ø£Ù„ÙˆØ§Ù† Ù…ØªÙˆØ§ÙÙ‚Ø© Ù…Ø¹ Ø«ÙŠÙ…Ùƒ â€”â€”â€” */
    :root{
      --primary-bg:#0b1220;--panel-bg:#141a22;--card-bg:#1b2230;--border:#273040;--ink:#e7eef7;--muted:#9aa7b4;--accent:#22c55e;--accent-2:#4098e6;--danger:#ef4444;--warning:#f59e0b;--ok:#10b981;--hover:#243042;--radius:14px
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--primary-bg);color:var(--ink);font:14px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial}

    /* Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© Ø¯Ø§Ø®Ù„ settings.html */
    .header{display:flex;align-items:center;justify-content:space-between;padding:16px 14px;background:linear-gradient(135deg,var(--panel-bg),var(--card-bg));border-bottom:1px solid var(--border);position:sticky;top:0;z-index:10}
    .header h1{margin:0;color:var(--accent);font-size:20px}
    .header p{margin:0;color:var(--muted);font-size:13px}

    .wrap{max-width:1100px;margin:0 auto;padding:16px}

    /* Ø´Ø¨ÙƒØ© Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª */
    .grid{display:grid;grid-template-columns:2fr 1fr;gap:14px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}

    .card{background:var(--panel-bg);border:1px solid var(--border);border-radius:var(--radius);box-shadow:0 10px 28px #0003}
    .card .head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
    .card .head h2{margin:0;font-size:16px}
    .card .body{padding:16px}

    .muted{color:var(--muted)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width: 720px){.row{grid-template-columns:1fr}}

    /* Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ */
    label{display:block;font-weight:700;margin-bottom:6px}
    .field{margin-bottom:14px}
    .ctl{display:flex;align-items:center;background:var(--card-bg);border:1px solid var(--border);border-radius:12px;padding:10px}
    .ctl input{flex:1;background:transparent;border:0;outline:0;color:var(--ink);font:inherit}
    .ctl .prefix{opacity:.8;margin-inline-end:8px}

    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
    .btn{appearance:none;border:1px solid var(--border);background:var(--card-bg);color:var(--ink);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:800}
    .btn:hover{background:var(--hover)}
    .btn.primary{background:var(--accent);border-color:#16a34a;color:#081018}
    .btn.primary:hover{filter:brightness(1.05)}
    .btn.ghost{background:transparent}
    .btn.warn{background:#1f2937;border-color:#334155;color:#fef08a}

    .help{font-size:12px;color:var(--muted);margin-top:4px}

    /* Ø±Ø³Ø§Ø¦Ù„ */
    .alert{border-radius:12px;padding:10px 12px;margin-top:8px}
    .alert.ok{background:#052e26;border:1px solid #0d453c;color:#a7f3d0}
    .alert.err{background:#3b0d0d;border:1px solid #7f1d1d;color:#fecaca}

    /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ© */
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th,td{text-align:start;padding:10px 12px}
    thead th{color:var(--muted);font-weight:700}
    tbody tr{background:var(--card-bg);border:1px solid var(--border)}
    tbody tr td:first-child{border-top-right-radius:12px;border-bottom-right-radius:12px}
    tbody tr td:last-child{border-top-left-radius:12px;border-bottom-left-radius:12px}
    .tag{display:inline-block;background:#0f172a;border:1px solid #1f2937;color:#cbd5e1;padding:2px 8px;border-radius:999px;font-size:12px}

    .right{display:flex;flex-direction:column;gap:14px}

    /* Ù…ÙØ§ØªÙŠØ­ ØªØ¨Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ·Ø© (Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ù…Ù‡Ø§Ù… Ø£Ø®Ø±Ù‰) */
    .switch{display:flex;align-items:center;gap:10px}
    .switch input{appearance:none;width:42px;height:24px;background:#1f2937;border:1px solid #334155;border-radius:999px;position:relative;cursor:pointer}
    .switch input:checked{background:#14532d;border-color:#166534}
    .switch input:before{content:"";position:absolute;top:3px;left:3px;width:18px;height:18px;background:#e2e8f0;border-radius:50%;transition:.2s}
    .switch input:checked:before{left:21px;background:#86efac}

    .hr{height:1px;background:var(--border);margin:12px 0}

    /* Toast */
    .toast{position:fixed;inset-inline-end:16px;inset-block-end:16px;background:#0b1220;border:1px solid var(--border);color:var(--ink);padding:12px 14px;border-radius:12px;box-shadow:0 10px 28px #0006;opacity:0;transform:translateY(8px);transition:.2s}
    .toast.show{opacity:1;transform:none}
  </style>
</head>
<body>
  <div class="header">
    <div>
      <h1>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>
      <p class="muted">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø£Ù†ÙŠÙ‚Ø© â€” Ù…Ù‡Ø§Ù… ÙƒØ«ÙŠØ±Ø© Ù…Ù† Ø¶Ù…Ù†Ù‡Ø§ Ø¥Ø¶Ø§ÙØ© ØµÙØ­Ø§Øª Ù„Ù„Ù…Ø´Ø±ÙˆØ¹</p>
    </div>
  </div>

  <div class="wrap">
    <div class="grid">

      <!-- ÙŠØ³Ø§Ø±: Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙØ­Ø§Øª -->
      <section class="card">
        <div class="head">
          <h2>ğŸ“„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙØ­Ø§Øª ÙˆØ§Ù„Ù‚ÙˆØ§Ø¦Ù…</h2>
          <span class="muted">Ø£Ø¶Ù Ø¹Ù†Ø§ØµØ± ÙƒØµÙØ­Ø§Øª ÙØ¹Ù„ÙŠØ© Ø£Ùˆ ÙƒÙ€ Parent Menu ØªØ­ØªÙˆÙŠ ØµÙØ­Ø§Øª ÙØ±Ø¹ÙŠØ©</span>
        </div>
        <div class="body">
          <form id="pageForm">
            <div class="row">
              <div class="field">
                <label>Ø§Ù„Ù†ÙˆØ¹</label>
                <div class="ctl" style="gap:12px">
                  <label style="display:flex;align-items:center;gap:6px"><input type="radio" name="type" value="page" checked> ØµÙØ­Ø©</label>
                  <label style="display:flex;align-items:center;gap:6px"><input type="radio" name="type" value="parent"> Parent Menu</label>
                </div>
                <div class="help">Parent Menu Ø¹Ù†ØµØ± ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ÙØªØ­ØŒ ÙŠÙØ³ØªØ®Ø¯Ù… Ù„ØªØ¬Ù…ÙŠØ¹ ØµÙØ­Ø§Øª ØªØ­ØªÙ‡</div>
              </div>
              <div class="field">
                <label>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</label>
                <div class="ctl">
                  <span class="prefix">ğŸ“š</span>
                  <select id="parentSelect" style="flex:1;background:transparent;border:0;color:var(--ink);outline:0">
                    <option value="">(Ø¹ÙÙ„ÙˆÙŠ â€” Ø¨Ø¯ÙˆÙ† Ø£Ø¨)</option>
                  </select>
                </div>
                <div class="help">Ø§Ø®ØªØ± Ø£Ø¨Ù‹Ø§ Ù„Ùˆ Ø£Ø±Ø¯Øª Ø¬Ø¹Ù„ Ø§Ù„Ø¹Ù†ØµØ± ÙØ±Ø¹ÙŠÙ‹Ø§Ø› Ù…ØªØ§Ø­ ÙÙ‚Ø· Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙƒÙˆÙ† Ø§Ù„Ù†ÙˆØ¹ "ØµÙØ­Ø©"</div>
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label>Ø§Ù„Ù…Ø¹Ø±Ù‘Ù (id)</label>
                <div class="ctl">
                  <span class="prefix"># /</span>
                  <input id="id" placeholder="reports" required pattern="[a-zA-Z0-9_-]{2,}">
                </div>
                <div class="help">Ù…Ø«Ø§Ù„ Ø§Ù„Ù…Ø³Ø§Ø± <span class="tag">#/reports</span></div>
              </div>
              <div class="field" id="fileField">
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù (file)</label>
                <div class="ctl">
                  <span class="prefix">ğŸ“„</span>
                  <input id="file" placeholder="reports.html">
                </div>
                <div class="help">Ù…Ù„Ù HTML Ø¨Ø¬Ø§Ù†Ø¨ <span class="tag">index.html</span> (ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨ Ù„Ù€ Parent)</div>
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label>Ø§Ù„ØªØ³Ù…ÙŠØ© (label)</label>
                <div class="ctl">
                  <span class="prefix">ğŸ·ï¸</span>
                  <input id="label" placeholder="Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±" required>
                </div>
              </div>
              <div class="field">
                <label>Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© (emoji)</label>
                <div class="ctl">
                  <span class="prefix">âœ¨</span>
                  <input id="icon" placeholder="ğŸ“Š" required>
                </div>
              </div>
            </div>

            <div class="actions">
              <button type="submit" class="btn primary">â• Ø¥Ø¶Ø§ÙØ©</button>
              <button type="button" id="addOpen" class="btn">â• Ø¥Ø¶Ø§ÙØ© ÙˆÙØªØ­ Ø§Ù„Ø¢Ù†</button>
              <button type="reset" class="btn ghost">ØªÙØ±ÙŠØº</button>
            </div>

            <div id="formMsg" class="alert" style="display:none"></div>
          </form>

          <div class="hr"></div>

          <h3 style="margin:0 0 8px">Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
          <div class="help">ØªÙ†Ø¸ÙŠÙ… Ù‡Ø±Ù…ÙŠ: Parents ÙˆØ¨Ø¯Ø§Ø®Ù„Ù‡Ø§ ØµÙØ­Ø§Øª ÙØ±Ø¹ÙŠØ©</div>
          <div style="margin-top:8px;overflow:auto">
            <table id="pagesTable">
              <thead>
                <tr><th>Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©</th><th>Ø§Ù„ØªØ³Ù…ÙŠØ©</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ø§Ù„Ù…Ø³Ø§Ø±/Ø§Ù„Ø£Ø·ÙØ§Ù„</th><th>Ø§Ù„Ù…Ù„Ù</th><th></th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ÙŠÙ…ÙŠÙ†: Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© (Ø£Ù…Ø§ÙƒÙ† Ù„Ù…Ù‡Ø§Ù… Ù‚Ø§Ø¯Ù…Ø©) -->
      <aside class="right">
        <section class="card">
          <div class="head"><h2>ğŸ¨ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ ÙˆØ§Ù„Ø«ÙŠÙ…</h2><span class="muted">Ù‚Ø±ÙŠØ¨Ù‹Ø§</span></div>
          <div class="body">
            <div class="switch"><input type="checkbox" id="dense"><label for="dense">ØªØ¨Ø§Ø¹Ø¯ Ù…Ø¶ØºÙˆØ·</label></div>
            <div class="switch"><input type="checkbox" id="animations" checked><label for="animations">Ø­Ø±ÙƒØ§Øª Ø§Ù†ØªÙ‚Ø§Ù„</label></div>
            <p class="help">Ù…ÙƒØ§Ù† Ø¬Ø§Ù‡Ø² Ù„Ù…Ù‡Ø§Ù… ØªØ®Øµ Ø§Ù„Ø«ÙŠÙ…/Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù…Ø³ØªÙ‚Ø¨Ù„Ù‹Ø§.</p>
          </div>
        </section>
        <section class="card">
          <div class="head"><h2>ğŸ§° Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆÙ‘Ø±</h2><span class="muted">Ù‚Ø±ÙŠØ¨Ù‹Ø§</span></div>
          <div class="body">
            <button class="btn warn" id="exportBtn">â¬‡ï¸ ØªØµØ¯ÙŠØ± Ø§Ù„ØµÙØ­Ø§Øª ÙƒÙ€ JSON</button>
            <div class="help">Ù„Ø£Ø®Ø° Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø£Ùˆ Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§</div>
          </div>
        </section>
      </aside>

    </div>
  </div>

  <div id="toast" class="toast">ØªÙ… Ø§Ù„Ø­ÙØ¸</div>

  <script>
    const tableBody = document.querySelector('#pagesTable tbody');
    const form = document.getElementById('pageForm');
    const msg = document.getElementById('formMsg');
    const toast = document.getElementById('toast');
    const parentSelect = document.getElementById('parentSelect');
    const fileField = document.getElementById('fileField');

    function showToast(text){ toast.textContent = text; toast.classList.add('show'); setTimeout(()=> toast.classList.remove('show'), 1500); }

    const KEY = 'customMenuTree';

    function getTree(){ return JSON.parse(localStorage.getItem(KEY) || '[]'); }
    function setTree(tree){ localStorage.setItem(KEY, JSON.stringify(tree)); }

    function listParents(){
      const tree = getTree();
      const parents = tree.filter(n=> n.type==='parent');
      parentSelect.innerHTML = '<option value="">(Ø¹ÙÙ„ÙˆÙŠ â€” Ø¨Ø¯ÙˆÙ† Ø£Ø¨)</option>' + parents.map(p=>`<option value="${p.id}">${p.label||p.id}</option>`).join('');
    }

    function renderTable(){
      const tree = getTree();
      const rows = [];
      const pushRow = (n, depth=0)=>{
        const pad = '&nbsp;'.repeat(depth*4);
        rows.push(`<tr>
          <td>${n.icon||'â€¢'}</td>
          <td>${pad}${n.label||n.id}</td>
          <td>${n.type==='parent'?'Parent':'Page'}</td>
          <td>${n.type==='page'?`<span class="tag">#/${n.id}</span>`:`Ø£Ø·ÙØ§Ù„: ${n.children?.length||0}`}</td>
          <td>${n.file||'-'}</td>
          <td style="text-align:end">
            ${n.type==='page'?`<button class="btn" data-open="#/${n.id}">ÙØªØ­</button>`:''}
            <button class="btn ghost" data-del="${n.id}">Ø­Ø°Ù</button>
          </td>
        </tr>`);
        (n.children||[]).forEach(c=> pushRow(c, depth+1));
      };
      tree.forEach(n=> pushRow(n));
      tableBody.innerHTML = rows.join('');
    }

    function addNode(node, parentId){
      const tree = getTree();
      if(parentId){
        const parent = tree.find(n=> n.id===parentId && n.type==='parent');
        if(!parent) throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¨');
        parent.children = parent.children||[];
        parent.children.push(node);
      }else{
        tree.push(node);
      }
      setTree(tree);
      // Ø£Ø®Ø·Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠØ· ÙÙˆØ±Ù‹Ø§
      try{ parent.postMessage({type:'MENU_TREE_UPDATED', tree: getTree()}, '*'); }catch(_){ }
    }

    function deleteNode(id){
      const rec = (arr)=>{
        const i = arr.findIndex(n=> n.id===id);
        if(i>-1){ arr.splice(i,1); return true; }
        for(const n of arr){ if(n.children && rec(n.children)) return true; }
        return false;
      };
      const tree = getTree();
      const ok = rec(tree);
      if(ok){ setTree(tree); try{ parent.postMessage({type:'MENU_TREE_UPDATED', tree}, '*'); }catch(_){} }
      return ok;
    }

    function raise(text){ msg.style.display='block'; msg.className='alert err'; msg.textContent='âš ï¸ '+text; }
    function ok(text){ msg.style.display='block'; msg.className='alert ok'; msg.textContent='âœ… '+text; }

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
    form.addEventListener('change', (e)=>{
      const type = new FormData(form).get('type');
      const isParent = (type==='parent');
      parentSelect.disabled = isParent; // Ù„Ø§ Ù…Ø¹Ù†Ù‰ Ù„Ø§Ø®ØªÙŠØ§Ø± Ø£Ø¨ Ù„Ø¹Ù†ØµØ± Ø£Ø¨
      document.getElementById('file').required = !isParent;
      fileField.style.opacity = isParent? .5:1;
    });

    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const fd = new FormData(form);
      const type = fd.get('type');
      const node = {
        id   : document.getElementById('id').value.trim(),
        label: document.getElementById('label').value.trim(),
        icon : document.getElementById('icon').value.trim(),
        type
      };
      if(type==='page') node.file = document.getElementById('file').value.trim();
      const parentId = type==='page' ? (document.getElementById('parentSelect').value||'') : '';

      if(!node.id || !node.label || !node.icon) return raise('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
      if(type==='page' && !node.file) return raise('Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„ØµÙØ­Ø©');
      if(!/^[a-zA-Z0-9_-]{2,}$/.test(node.id)) return raise('Ù…Ø¹Ø±Ù‘Ù ØºÙŠØ± ØµØ§Ù„Ø­');

      // ÙØ­Øµ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø¬Ø±Ø© (Ø¨Ø´ÙƒÙ„ Ø¨Ø³ÙŠØ·)
      const dup = JSON.stringify(getTree()).includes(`"id":"${node.id}"`);
      if(dup) return raise('ÙŠÙˆØ¬Ø¯ Ø¹Ù†ØµØ± Ø¨Ù†ÙØ³ Ø§Ù„Ù…Ø¹Ø±Ù‘Ù');

      addNode(node, parentId||null);
      ok('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©'); showToast('ØªÙ… Ø§Ù„Ø­ÙØ¸');
      listParents(); renderTable(); form.reset();
      form.dispatchEvent(new Event('change')); // Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ required
    });

    document.getElementById('addOpen').addEventListener('click', ()=>{
      form.requestSubmit();
      const tree = getTree();
      // Ø§ÙØªØ­ Ø¢Ø®Ø± ØµÙØ­Ø© ØªÙ…Øª Ø¥Ø¶Ø§ÙØªÙ‡Ø§ (Ø¥Ù† ÙƒØ§Ù†Øª Ù…Ù† Ø§Ù„Ù†ÙˆØ¹ ØµÙØ­Ø©)
      const openLastPage = (arr)=>{
        for(let i=arr.length-1;i>=0;i--){
          const n = arr[i];
          if(n.type==='page') return n;
          if(n.children){ const hit = openLastPage(n.children); if(hit) return hit; }
        }
      };
      const p = openLastPage(tree);
      if(p){ try{ parent.location.hash = `#/${p.id}`; }catch(_){} }
    });

    document.getElementById('pagesTable').addEventListener('click', (e)=>{
      const btn = e.target.closest('button'); if(!btn) return;
      if(btn.dataset.del){
        const id = btn.dataset.del;
        if(deleteNode(id)){ renderTable(); showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù'); listParents(); }
      }
      if(btn.dataset.open){ try{ parent.location.hash = btn.dataset.open; }catch(_){} }
    });

    // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
    if(!localStorage.getItem(KEY)) setTree([]);
    listParents(); renderTable();
        // Ø¥Ø®Ø·Ø§Ø± index.html Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ sidebar Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù† Ø£Ù…ÙƒÙ†
        try{ parent.postMessage({type:'NEW_PAGE_ADDED', page}, '*'); }catch(_){}
        form.reset();
      }
    });

    document.getElementById('addOpen').addEventListener('click', ()=>{
      // ÙŠØ­Ø§ÙˆÙ„ Ø¥Ø¶Ø§ÙØ© Ø«Ù… ÙŠÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
      const evt = new Event('submit');
      let blocked = false;
      form.dispatchEvent(new Event('submit'));
      // Ø§ÙØªØ­ Ø¢Ø®Ø± Ø¹Ù†ØµØ± Ø¥Ø°Ø§ Ù†Ø¬Ø­ Ø§Ù„Ø­ÙØ¸
      const saved = JSON.parse(localStorage.getItem('customPages') || '[]');
      const p = saved[saved.length-1];
      if(p){ try{ parent.location.hash = `#/${p.id}`; }catch(_){} }
    });

    document.getElementById('pagesTable').addEventListener('click', (e)=>{
      const btn = e.target.closest('button'); if(!btn) return;
      if(btn.dataset.del){
        const i = +btn.dataset.del;
        const saved = JSON.parse(localStorage.getItem('customPages') || '[]');
        const removed = saved.splice(i,1)[0];
        localStorage.setItem('customPages', JSON.stringify(saved));
        loadPages();
        showToast(`ØªÙ… Ø­Ø°Ù ${removed?.label||removed?.id}`);
        try{ parent.postMessage({type:'PAGE_REMOVED', id: removed.id}, '*'); }catch(_){}
      }
      if(btn.dataset.open){
        try{ parent.location.hash = btn.dataset.open; }catch(_){}
      }
    });

    document.getElementById('exportBtn').addEventListener('click', ()=>{
      const data = localStorage.getItem('customPages') || '[]';
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'customPages.json'; a.click();
      URL.revokeObjectURL(url);
      showToast('ØªÙ… ØªØµØ¯ÙŠØ± JSON');
    });

    // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
    loadPages();
  </script>
</body>
</html>
